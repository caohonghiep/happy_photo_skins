var imagesJson
imagesJson = [
    //1
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xfp1/t31.0-8/10295395_286625644849465_7339904325810261739_o.jpg    ",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xfp1/t31.0-8/10295395_286625644849465_7339904325810261739_o.jpg    "

    },
    //2
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xap1/t31.0-8/10348688_286625924849437_3724238609749085233_o.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xap1/t31.0-8/10348688_286625924849437_3724238609749085233_o.jpg"

    },
    //3
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpf1/t1.0-9/10302739_286626111516085_2892049830842423971_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpf1/t1.0-9/10302739_286626111516085_2892049830842423971_n.jpg"

    },
    //4
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xfa1/t1.0-9/10371502_286626321516064_4400943621497011730_n.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xfa1/t1.0-9/10371502_286626321516064_4400943621497011730_n.jpg"

    },
    //5
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10403723_286626541516042_3610136303669559564_n.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10403723_286626541516042_3610136303669559564_n.jpg"

    },
    //6
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10369222_286626674849362_8992109576597737797_n.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10369222_286626674849362_8992109576597737797_n.jpg"

    },
    //7
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10298898_286627081515988_17690179085757561_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10298898_286627081515988_17690179085757561_n.jpg"

    },
    //8
    {
        "title": "",
        "description": "",
        "imageThumbURL": " https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10298952_286628364849193_6469941156418103942_n.jpg",
        "imageURL": " https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10298952_286628364849193_6469941156418103942_n.jpg"

    },
    //9
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xpf1/t31.0-8/10333742_286628971515799_3927274814435147153_o.jpg",
        "imageURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xpf1/t31.0-8/10333742_286628971515799_3927274814435147153_o.jpg"

    },
    //10
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfa1/t31.0-8/10258769_286629824849047_788112812535504289_o.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfa1/t31.0-8/10258769_286629824849047_788112812535504289_o.jpg"

    },
    //11
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10403107_286629951515701_8392726148684514823_n.jpg",
        "imageURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10403107_286629951515701_8392726148684514823_n.jpg "

    }
    //11
    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10325565_286630328182330_4885438813848041518_n.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10325565_286630328182330_4885438813848041518_n.jpg"

    }
    //12
    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10264849_286631968182166_6567531924616779012_n.jpg",
        "imageURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10264849_286631968182166_6567531924616779012_n.jpg"

    }
    //13
    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10295377_286632434848786_7785596364289129206_o.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10295377_286632434848786_7785596364289129206_o.jpg"

    },
    //14
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/10373634_286602401518456_4614659149000081791_n.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/10373634_286602401518456_4614659149000081791_n.jpg"

    },
    //15
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10257857_286602711518425_8961270877572978332_o.jpg",
        "imageURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10257857_286602711518425_8961270877572978332_o.jpg"

    },
    //16
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xfp1/t31.0-8/10264195_286603001518396_8629906978157748937_o.jpg",
        "imageURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xfp1/t31.0-8/10264195_286603001518396_8629906978157748937_o.jpg"

    },
    //17
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10298543_286603701518326_1423466476159731915_o.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10298543_286603701518326_1423466476159731915_o.jpg"

    },
    //18
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10383730_286603991518297_6237970533732315948_o.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10383730_286603991518297_6237970533732315948_o.jpg"

    },
    //19
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10321212_286604098184953_4178433354573704240_o.jpg",
        "imageURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10321212_286604098184953_4178433354573704240_o.jpg"

    },
    //20
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10380169_286604244851605_606044130194645813_o.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10380169_286604244851605_606044130194645813_o.jpg"

    },
    //21
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xfa1/t31.0-8/10273232_286604808184882_2666500488331211946_o.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xfa1/t31.0-8/10273232_286604808184882_2666500488331211946_o.jpg"

    },
    //22
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10259082_286605058184857_2755869430622174964_o.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10259082_286605058184857_2755869430622174964_o.jpg"

    },
    //23
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xfp1/t31.0-8/10275340_286605351518161_7639517901678694302_o.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xfp1/t31.0-8/10275340_286605351518161_7639517901678694302_o.jpg"

    } ,
    //24
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10339540_286605734851456_1653912516135948060_o.jpg",
        "imageURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10339540_286605734851456_1653912516135948060_o.jpg"

    },
    //25
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/1618062_286605851518111_935382564062757549_o.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/1618062_286605851518111_935382564062757549_o.jpg"

    },
    //26
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10273335_286607571517939_1835304981463528890_o.jpg",
        "imageURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10273335_286607571517939_1835304981463528890_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10293576_286608191517877_4478442016334975608_o.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10293576_286608191517877_4478442016334975608_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10293576_286608191517877_4478442016334975608_o.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10293576_286608191517877_4478442016334975608_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10339714_286609038184459_5946254879519412366_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10339714_286609038184459_5946254879519412366_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10330284_286610321517664_4541707966222487553_n.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10330284_286610321517664_4541707966222487553_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/l/t1.0-9/10371583_286610481517648_2110770905044156395_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/l/t1.0-9/10371583_286610481517648_2110770905044156395_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10373121_286611591517537_8185429564911199550_o.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/10373121_286611591517537_8185429564911199550_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/1956780_286611881517508_6426737515714808474_o.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xpa1/t31.0-8/1956780_286611881517508_6426737515714808474_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xpf1/t31.0-8/10259307_286613301517366_9159656187298449773_o.jpg",
        "imageURL": "https://scontent-b-lax.xx.fbcdn.net/hphotos-xpf1/t31.0-8/10259307_286613301517366_9159656187298449773_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfa1/t31.0-8/10263985_286613561517340_8069136171823506541_o.jpg",
        "imageURL": "https://fbcdn-sphotos-a-a.akamaihd.net/hphotos-ak-xfa1/t31.0-8/10263985_286613561517340_8069136171823506541_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10154249_286614108183952_7007824264596835697_n.jpg",
        "imageURL": "https://fbcdn-sphotos-f-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10154249_286614108183952_7007824264596835697_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10371955_286615071517189_4235815647751471509_n.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/10371955_286615071517189_4235815647751471509_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10382608_286616854850344_5274473242292042213_o.jpg",
        "imageURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10382608_286616854850344_5274473242292042213_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10258703_286618201516876_3224622085239747287_o.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xap1/t31.0-8/10258703_286618201516876_3224622085239747287_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1013812_286618831516813_4160199028970871453_n.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1013812_286618831516813_4160199028970871453_n.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10285350_286619218183441_4821157632720649083_o.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xpf1/t31.0-8/10285350_286619218183441_4821157632720649083_o.jpg"

    }

    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xfp1/t31.0-8/10275597_286625041516192_4267307372864332287_o.jpg",
        "imageURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xfp1/t31.0-8/10275597_286625041516192_4267307372864332287_o.jpg"

    }



];
var numberImagesLoades = 0;
var loadableNextImage = true;
var indexImageLoading = 0;
var numberImages = imagesJson.length;
var contentType = 'image/png';

function base64toBlob(base64Data, contentType) {
    //http://stackoverflow.com/questions/16245767/creating-a-blob-from-a-base64-string-in-javascript
    //http://stackoverflow.com/questions/11850970/javascript-blob-object-to-base64
    contentType = contentType || '';
    var sliceSize = 1024;
    var byteCharacters = atob(base64Data);
    var bytesLength = byteCharacters.length;
    var slicesCount = Math.ceil(bytesLength / sliceSize);
    var byteArrays = new Array(slicesCount);

    for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
        var begin = sliceIndex * sliceSize;
        var end = Math.min(begin + sliceSize, bytesLength);

        var bytes = new Array(end - begin);
        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
            bytes[i] = byteCharacters[offset].charCodeAt(0);
        }
        byteArrays[sliceIndex] = new Uint8Array(bytes);
    }
    return new Blob(byteArrays, {type: contentType});
}



function convertImgToBase64(index) {
    //http://jsfiddle.net/handtrix/YvQ5y/
    if (imagesJson[index].imageURL !=null && imagesJson[index].imageURL.length>0 && imagesJson[index].imageURL.indexOf('blob:') < 0) {
        var canvas = document.createElement('CANVAS');
        var ctx = canvas.getContext('2d');
        var img = new Image;
        img.crossOrigin = 'Anonymous';
        img.onload = function() {
            /*
             canvas.height = img.height;
             canvas.width = img.width;
             ctx.drawImage(img, 0, 0);
             */
            var fullWidth = window.innerWidth;
            var fullHeight = window.innerHeight - 10;
            var canvas = document.createElement('canvas');
            canvas.setAttribute('width', fullWidth);
            canvas.setAttribute('height', fullHeight);
            var context = canvas.getContext('2d');
            var imageHeight = this.height;
            var imageWidth = this.width;


            var t = fullHeight / imageHeight;
            if (t < fullWidth / imageWidth) {
                t = fullWidth / imageWidth;
            }
            var heightView = imageHeight * t;
            var widthView = imageWidth * t;

            context.drawImage(img, -(widthView - fullWidth) / 2, -(heightView - fullHeight) / 2, widthView, heightView);




            var dataURL = canvas.toDataURL('image/png');
            var blob = base64toBlob(dataURL.substr(dataURL.indexOf(',') + 1), contentType);
            var blobUrl = URL.createObjectURL(blob);
            //imagesJson[index].imageURL = dataURL;
            imagesJson[index].imageURL = blobUrl;
            canvas = null;
            dataURL = null;
            loadableNextImage = true;
            indexImageLoading++;
            numberImagesLoades++;
        };
        img.src = imagesJson[index].imageURL;
    } else {
        loadableNextImage = true;
        indexImageLoading++;
        numberImagesLoades++;
    }
}

var checkLoadedImages = setInterval(function() {
    var pecent;
    var numberImages = imagesJson.length;    
    
    if (indexImageLoading === numberImages) {
        clearInterval(checkLoadedImages);
        jQuery('#loaded').remove();        
        createHtmlView(imagesJson, jQuery('#camera_wrap')[0]);
        setTimeout(function(){
            jQuery('.camera_next').click();
            jQuery('.camera_loader').remove();//.css('display','none');
        },5000);
        FullHappyCookie.setCookie("imageData", JSON.stringify(imagesJson));
    } else if (loadableNextImage) {
        loadableNextImage = false;
        convertImgToBase64(indexImageLoading);
        pecent = Math.round((indexImageLoading / numberImages) * 100);
        jQuery('#loaded').html(pecent + ' % đang tải ...');
        //start 
        if(numberImages>=10 && indexImageLoading===2){
            setTimeout(function (){createHtmlViewNumber(imagesJson, jQuery('#camera_wrap')[0],indexImageLoading-1);},1);
            
        }
        
        if(numberImages>=20 && indexImageLoading===5){
            setTimeout(function (){createHtmlViewNumber(imagesJson, jQuery('#camera_wrap')[0],indexImageLoading-1);},1);
            
        }
        
        if(numberImages>=40 && indexImageLoading===10){
            setTimeout(function (){createHtmlViewNumber(imagesJson, jQuery('#camera_wrap')[0],indexImageLoading-1);},1);
            
        }
        //end
    }
}, 500);




function createHtmlView(imagesJson, container) {
    jQuery('#camera_wrap').find('*').remove(); 
    var numberOfImages = imagesJson.length;
    var pecent;
    for (var i = 0; i < numberOfImages; i++) {
        pecent = Math.round((i / numberOfImages) * 100);
        jQuery('#built').html(pecent + ' % xây dựng ...');
        container.appendChild(
                createChildNode(imagesJson[i].imageURL));
    }
    jQuery('#built').remove();
    startSlide();

}

function createHtmlViewNumber(imagesJson, container,endNumber) {
    jQuery('#camera_wrap').find('*').remove(); 
    var numberOfImages = endNumber<=imagesJson.length?endNumber:imagesJson.length;
    var pecent;
    for (var i = 0; i <= numberOfImages; i++) {
        pecent = Math.round((i / numberOfImages) * 100);
        jQuery('#built').html(pecent + ' % xây dựng ...');
        container.appendChild(
                createChildNode(imagesJson[i].imageURL));
    }
    jQuery('#built').remove();
    startSlide();

}

function createChildNode(imageUrl) {

    var div = document.createElement('div');
    div.setAttribute('data-src', imageUrl);
    div.setAttribute('data-thumb', imageUrl);
    return div;

}

function startSlide() {

    jQuery('#camera_wrap').camera({
        /*height: '56%',*/
        pagination: false,
        thumbnails: true,
        imagePath: './images/',
        time: 3000,
        transPeriod: 1500,
        hover: false
    });


}