var imagesJson = [
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/1891213_544359255671162_1964473336_n.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/1891213_544359255671162_1964473336_n.jpg"
    },
     {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/1796525_552158698224551_1007453898_n.jpg",
        "imageURL": "https://fbcdn-sphotos-b-a.akamaihd.net/hphotos-ak-xpf1/t1.0-9/1796525_552158698224551_1007453898_n.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1939972_552691228171298_1706629652_n.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1939972_552691228171298_1706629652_n.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1948018_552618031511951_1563856377_n.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1948018_552618031511951_1563856377_n.jpg"
    },    
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/1972415_553904384716649_2017983891_n.jpg",
        "imageURL": "https://fbcdn-sphotos-g-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/1972415_553904384716649_2017983891_n.jpg"
    },
    
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xfa1/t1.0-9/5514_559233314183756_212675623_n.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xfa1/t1.0-9/5514_559233314183756_212675623_n.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1622201_555479777892443_334793673_n.jpg",
        "imageURL": "https://fbcdn-sphotos-d-a.akamaihd.net/hphotos-ak-xap1/t1.0-9/1622201_555479777892443_334793673_n.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xaf1/t1.0-9/1461221_557973884309699_130136547_n.jpg",
        "imageURL": "https://fbcdn-sphotos-c-a.akamaihd.net/hphotos-ak-xaf1/t1.0-9/1461221_557973884309699_130136547_n.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10002921_566322266808194_683525479_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xpa1/t1.0-9/10002921_566322266808194_683525479_n.jpg"
    },
    
    
    
    
    
    
    
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xaf1/t1.0-9/1898284_560947374012350_1092483609_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xaf1/t1.0-9/1898284_560947374012350_1092483609_n.jpg"
    },
    
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/10246450_571016579672096_4521887765832761687_n.jpg",
        "imageURL": "https://fbcdn-sphotos-e-a.akamaihd.net/hphotos-ak-xpa1/t1.0-9/10246450_571016579672096_4521887765832761687_n.jpg"
    }
    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xaf1/t1.0-9/10262071_576542922452795_8435390013639179961_n.jpg",
        "imageURL": "https://scontent-a-lax.xx.fbcdn.net/hphotos-xaf1/t1.0-9/10262071_576542922452795_8435390013639179961_n.jpg"
    }
    ,
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10277640_576542999119454_4844493093588208769_n.jpg",
        "imageURL": "https://fbcdn-sphotos-h-a.akamaihd.net/hphotos-ak-xfp1/t1.0-9/10277640_576542999119454_4844493093588208769_n.jpg"
    }
    /*
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh3.googleusercontent.com/-1e-ZjPpZL8Y/UyPm6aNm8iI/AAAAAAAADrg/B4pcypP16EU/s288/1.JPG",
        "imageURL": "https://lh3.googleusercontent.com/-1e-ZjPpZL8Y/UyPm6aNm8iI/AAAAAAAADrg/B4pcypP16EU/s4000/1.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh4.googleusercontent.com/-0HJJtS8j7w4/UyPnAalz4yI/AAAAAAAADrg/5-r6r7QG3jU/s288/2.JPG",
        "imageURL": "https://lh4.googleusercontent.com/-0HJJtS8j7w4/UyPnAalz4yI/AAAAAAAADrg/5-r6r7QG3jU/s4000/2.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh6.googleusercontent.com/-Kfqln-mutOo/UyPn4Ux5GtI/AAAAAAAADrg/k70ptP3LReI/s288/3.JPG",
        "imageURL": "https://lh6.googleusercontent.com/-Kfqln-mutOo/UyPn4Ux5GtI/AAAAAAAADrg/k70ptP3LReI/s4000/3.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh4.googleusercontent.com/-2uQ6cM1nuEI/UyPoQxvJupI/AAAAAAAADrg/t6hfqUuuMMk/s288/4.JPG",
        "imageURL": "https://lh4.googleusercontent.com/-2uQ6cM1nuEI/UyPoQxvJupI/AAAAAAAADrg/t6hfqUuuMMk/s4000/4.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh6.googleusercontent.com/-wbDHjH6BTQg/UyPnzfLVlzI/AAAAAAAADrg/GMglxtbN5xc/s288/5.JPG",
        "imageURL": "https://lh6.googleusercontent.com/-wbDHjH6BTQg/UyPnzfLVlzI/AAAAAAAADrg/GMglxtbN5xc/s4000/5.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh5.googleusercontent.com/-ylwrHBFOQac/UyPooJ3NNSI/AAAAAAAADrg/a9LOHO2CxI4/s288/6.jpg",
        "imageURL": "https://lh5.googleusercontent.com/-ylwrHBFOQac/UyPooJ3NNSI/AAAAAAAADrg/a9LOHO2CxI4/s4000/6.jpg"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh4.googleusercontent.com/-XUkBq8hxnI0/UyPpl3OZ3ZI/AAAAAAAADrg/kM4RhcG0Iyg/s288/7.JPG",
        "imageURL": "https://lh4.googleusercontent.com/-XUkBq8hxnI0/UyPpl3OZ3ZI/AAAAAAAADrg/kM4RhcG0Iyg/s4000/7.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh5.googleusercontent.com/-yuptxUruUhI/UyPpvT4ccFI/AAAAAAAADrg/SxO0QGLNRcM/s288/8.JPG",
        "imageURL": "https://lh5.googleusercontent.com/-yuptxUruUhI/UyPpvT4ccFI/AAAAAAAADrg/SxO0QGLNRcM/s4000/8.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh6.googleusercontent.com/-Y2TEpHOsf6g/UyPpy-3HT9I/AAAAAAAADrg/3G6KP0H2aMM/s288/9.JPG",
        "imageURL": "https://lh6.googleusercontent.com/-Y2TEpHOsf6g/UyPpy-3HT9I/AAAAAAAADrg/3G6KP0H2aMM/s4000/9.JPG"
    },
    {
        "title": "",
        "description": "",
        "imageThumbURL": "https://lh3.googleusercontent.com/-mGAdXJfT7EI/UyPmu4igGRI/AAAAAAAADrg/8ndhMfGJ-S8/s288/10.JPG",
        "imageURL": "https://lh3.googleusercontent.com/-mGAdXJfT7EI/UyPmu4igGRI/AAAAAAAADrg/8ndhMfGJ-S8/s4000/10.JPG"
    }*/
    
    ];

var animations = ["cube", "cubeRandom", "block", "cubeStop", "cubeHide", "cubeSize", "horizontal", "showBars", "showBarsRandom", "tube",
    "fade", "fadeFour", "paralell", "blind", "blindHeight", "blindWidth", "directionTop", "directionBottom", "directionRight",
    "directionLeft", "cubeStopRandom", "cubeSpread", "cubeJelly", "glassCube", "glassBlock", "circles", "circlesInside",
    "circlesRotate", "cubeShow", "upBars", "downBars", "hideBars", "swapBars", "swapBarsBack", "swapBlocks",
    "cut", "random", "randomSmart"];

var numberImagesLoades = 0;
var loadableNextImage = true;
var indexImageLoading = 0;
var numberImages = imagesJson.length;
var contentType = 'image/png';

function base64toBlob(base64Data, contentType) {
    //http://stackoverflow.com/questions/16245767/creating-a-blob-from-a-base64-string-in-javascript
    //http://stackoverflow.com/questions/11850970/javascript-blob-object-to-base64
    contentType = contentType || '';
    var sliceSize = 1024;
    var byteCharacters = atob(base64Data);
    var bytesLength = byteCharacters.length;
    var slicesCount = Math.ceil(bytesLength / sliceSize);
    var byteArrays = new Array(slicesCount);

    for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
        var begin = sliceIndex * sliceSize;
        var end = Math.min(begin + sliceSize, bytesLength);

        var bytes = new Array(end - begin);
        for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
            bytes[i] = byteCharacters[offset].charCodeAt(0);
        }
        byteArrays[sliceIndex] = new Uint8Array(bytes);
    }
    return new Blob(byteArrays, {type: contentType});
}



function convertImgToBase64(index) {
    //http://jsfiddle.net/handtrix/YvQ5y/
    if (imagesJson[index].imageURL !=null && imagesJson[index].imageURL.length>0 && imagesJson[index].imageURL.indexOf('blob:') < 0) {
        var canvas = document.createElement('CANVAS');
        var ctx = canvas.getContext('2d');
        var img = new Image;
        img.crossOrigin = 'Anonymous';
        img.onload = function() {
            /*
             canvas.height = img.height;
             canvas.width = img.width;
             ctx.drawImage(img, 0, 0);
             */
            var fullWidth = window.innerWidth;
            var fullHeight = window.innerHeight - 10;
            var canvas = document.createElement('canvas');
            canvas.setAttribute('width', fullWidth);
            canvas.setAttribute('height', fullHeight);
            var context = canvas.getContext('2d');
            var imageHeight = this.height;
            var imageWidth = this.width;


            var t = fullHeight / imageHeight;
            if (t < fullWidth / imageWidth) {
                t = fullWidth / imageWidth;
            }
            var heightView = imageHeight * t;
            var widthView = imageWidth * t;

            context.drawImage(img, -(widthView - fullWidth) / 2, -(heightView - fullHeight) / 2, widthView, heightView);




            var dataURL = canvas.toDataURL('image/png');
            var blob = base64toBlob(dataURL.substr(dataURL.indexOf(',') + 1), contentType);
            var blobUrl = URL.createObjectURL(blob);
            //imagesJson[index].imageURL = dataURL;
            imagesJson[index].imageURL = blobUrl;
            canvas = null;
            dataURL = null;
            loadableNextImage = true;
            indexImageLoading++;
            numberImagesLoades++;
        };
        img.src = imagesJson[index].imageURL;
    } else {
        loadableNextImage = true;
        indexImageLoading++;
        numberImagesLoades++;
    }
}

var checkLoadedImages = setInterval(function() {
    var pecent;
    var numberImages = imagesJson.length;
    if (indexImageLoading === numberImages) {
        clearInterval(checkLoadedImages);
        $('#loaded').remove();
        createHtmlView(imagesJson, animations, $('.border_box > div > ul')[0]);
    } else if (loadableNextImage) {
        loadableNextImage = false;
        convertImgToBase64(indexImageLoading);
        pecent = Math.round((indexImageLoading / numberImages) * 100);
        $('#loaded').html(pecent + ' % đang tải ...');
    }
}, 500);




function createHtmlView(imagesJson, animations, container) {
    var numberOfImages = imagesJson.length;
    var numberOfAnimations = animations.length;
    var pecent;
    for (var i = 0; i < numberOfImages; i++) {
        pecent = Math.round((i / numberOfImages) * 100);
        $('#built').html(pecent + ' % xây dựng ...');
        container.appendChild(
                createChildNode(imagesJson[i].imageURL,
                        animations[Math.floor((Math.random() * numberOfAnimations) + 1) % numberOfAnimations],
                        imagesJson[i].description));
    }
    $('#built').remove();
    startSlide();

}


function createChildNode(imageUrl, animation, description) {
    var li = document.createElement('li');
    var a = document.createElement('a');
    var img = new Image();// document.createElement('img');
    img.setAttribute('src', imageUrl);
    img.setAttribute('class', animation);
    a.appendChild(img);
    a.setAttribute('href', '#' + animation);
    li.appendChild(a);

    var div = document.createElement('div');
    var p = document.createElement('p');
    p.appendChild(document.createTextNode(description));
    div.appendChild(p);
    li.appendChild(div);

    return li;

}

function clickNextLoop() {
    $('.next_button').click();
}
function startSlide() {
    $('.box_skitter_large').css({width: $('.full_screen').width(), height: $('.full_screen').height()}).skitter({
        theme: 'clean',
        controls: true,
        controls_position: 'leftTop',
        interval: 3000,
        label: false,
        dots: true,
        numbers_align: 'center',
        preview: true,
        auto_play: false
    });
    setInterval(function() {
        clickNextLoop();
    }, 5000);
}